<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
    <title>주소록 상세</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; }
        .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
        .btn { display:inline-block; padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:#fafafa; cursor:pointer; }
        .row { display:flex; gap:12px; margin:8px 0; }
        .label-pill { display:inline-block; padding: 2px 8px; border:1px solid #ddd; border-radius:9999px; font-size:12px; margin-right:6px;}
        img.profile { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; background: #f1f3f5; }
        .field-label { color:#6c757d; width:110px; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>
    <div class="wrap">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
        <a class="btn" href="/contact/">← 목록</a>
        <button id="btnDelete" class="btn" style="color:#c00;">삭제</button>
        </div>

        <div class="card shadow-sm">
            <div class="card-body" id="detail">
                <!-- 상세 내용이 여기에 동적으로 삽입됩니다. -->
                <div class="text-center" id="loader">불러오는 중…</div>
                <div class="text-center d-none" id="empty">데이터가 없습니다.</div>
        </div>
    </div>

    <script>
        // Django context로 pk가 들어옵니다.
        const PK = "{{ pk }}";
        const API_URL = `/api/contact/${PK}/`;

        function renderDetail(c) {
            const labels = (c.labels || []).map(l => `<span class="label-pill">${l.name}</span>`).join('');
            return `
                <div class="d-flex align-items-center gap-3 mb-3">
                    <img id="profile_url" class="profile" src="${c.profile_url || ''}" alt="" onerror="this.style.visibility='hidden'"/>
                    <h4 id="name" class="mb-0">${c.name || ''}</h4>
                </div>
                <div class="row g-3">
                    <div class="col-12 d-flex"><div class="field-label">이메일</div> ${c.email || ''}</div>
                    <div class="col-12 d-flex"><div class="field-label">전화번호</div> ${c.phone || ''}</div>
                    <div class="col-12 d-flex"><div class="field-label">회사</div> ${c.company || ''}</div>
                    <div class="col-12 d-flex"><div class="field-label">직책</div> ${c.position || ''}</div>
                    <div class="col-12 d-flex"><div class="field-label">라벨</div> ${labels}</div>
                    <div class="col-12 d-flex"><div class="field-label">주소</div> ${c.address || ''}</div>
                    <div class="col-12 d-flex"><div class="field-label">생일</div> ${c.birthday || ''}</div>
                    <div class="col-12 d-flex"><div class="field-label">웹사이트</div> ${c.website || ''}</div>
                    <div class="col-12"><div class="field-label mb-1">메모</div><pre id="memo" class="memo mb-0">${(c.memo || '').replaceAll('\n','<br/>')}</pre></div>
                </div>
            `;
        }

        async function load() {
            const res = await fetch(API_URL, { headers: { 'Accept': 'application/json' }});
            const data = await res.json();
            document.getElementById('detail').innerHTML = renderDetail(data);
        }

        // CSRF (세션 인증 사용하는 경우에만 필요)
        function getCsrf() {
            const m = document.cookie.match(/csrftoken=([^;]+)/);
            return m ? m[1] : '';
        }

        document.getElementById('btnDelete').addEventListener('click', async () => {
            if (!confirm('정말 삭제하시겠어요?')) return;
            const res = await fetch(API_URL, {
                method: 'DELETE',
                headers: { 'X-CSRFToken': getCsrf() }
            });
            if (res.status === 204) {
                location.href = '/contact/';
            } else {
                alert('삭제 실패');
            }
        });

        load();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</body>
</html>
